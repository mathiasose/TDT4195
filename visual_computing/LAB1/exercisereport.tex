\chapter{Exercise 1}

All tasks are implemented in Python using the SciPy-stack.
Image data is parsed into Numpy arrays and processed using a combination of built-in functions from SciPy and functions we have implemented ourselves.

\section*{Task 3 - Basic Image Manipulation}

\subsection*{1 - Correct an image using a flatfield image}

Listing \ref{flatfield} shows the two relevant functions implemented for this task.
For the complete implementation including reading the image files and saving/showing the end result, see the file \texttt{flatfield.py}.

\begin{lstlisting}[language=Python, label=flatfield, caption=Flatfield image correction]
def normalize_bw(img_matrix):
    return map(lambda row: map(lambda val: val / 255, row), img_matrix)


def correct_with_flatfield(img, flatfield):
    corrected = deepcopy(img)
    for y, (a_row, b_row) in enumerate(zip(img, flatfield)):
        for x, (a_px, b_px) in enumerate(zip(a_row, b_row)):
            corrected[y][x] = a_px / b_px

    return corrected
\end{lstlisting}

\begin{figure}[h!]
    \centering
    \includegraphics[width=5cm]{../LAB1/img/disturbed_potw1144a.png}
    \includegraphics[width=5cm]{../LAB1/img/flatfieldimage.png}
    \includegraphics[width=5cm]{../LAB1/output/disturbed_potw1144a.png}
    \caption{From the left: original, flat-field image, corrected}
\end{figure}

\subsection*{2 - Speculation}

When performing flat-field correction we want to compensate for imperfections of the detector by scaling the intensity value of a pixel by scaling with the intensity value of the same pixel in the flat-field image.
If we did this by subtraction, i.e original\_pixel\_intensity - flat\_field\_intensity, we could end up with negative values.

\input{../LAB1/point_processing}

\clearpage
\section*{Task 5 - Noise}

\subsection*{1 - Salt \& Pepper noise}

Since SciPy, and PIL specifically, doesn't provide an \texttt{imnoise}-function, this task had to be implemented manually. Listing \ref{salt-and-pepper} shows the functions of interest for this task.

\begin{lstlisting}[language=Python, label=salt-and-pepper, caption=Salt \& pepper noise]
def salt_and_pepper_noise(matrix, density):
    return pixel_wise_transform(matrix, lambda px: np.random.randint(2) if np.random.random() < density else px)

# pixel_wise_transform implementation
def pixel_wise_transform(matrix, fun):
    '''
    applies fun(px) to every px in the 2d matrix
    '''
    return np.asarray(map(lambda row: map(lambda px: fun(px), row), matrix))
\end{lstlisting}


\begin{figure}[h!]
    \centering
    \includegraphics[width=5cm]{../LAB1/img/lena.png}
    \includegraphics[width=5cm]{../LAB1/output/noisy_0_1.png} \\
    \includegraphics[width=5cm]{../LAB1/output/noisy_0_3.png}
    \includegraphics[width=5cm]{../LAB1/output/noisy_0_8.png}
    \caption{Results of adding noise to Lena. From top left to bottom right: original, density = 0.1, density = 0.3, density = 0.8}
\end{figure}

There are several other types of image noise; gaussian, shot, uniform, film grain and anisotropic.

\newpage

\section*{Task 6 - Aliasing}

See listing \ref{aliasing}. The effect observed is called aliasing. 

\begin{lstlisting}[language=Python, label=aliasing, caption=Aliasing function]
def alias(img_mat, factor):
    ret = []
    for y in range(len(img_mat)):
        if y % factor == 0:
            l = []
            for x in range(len(img_mat[0])):
                if x % factor == 0:
                    l.append(img_mat[y][x])
            ret.append(l)
    return asarray(ret)
\end{lstlisting}

\begin{figure}[h!]
    \centering
    \includegraphics[width=5cm]{../LAB1/img/bricks.png}
    \includegraphics[width=5cm]{../LAB1/output/brick_down_2x.png} \\
    \includegraphics[width=5cm]{../LAB1/output/brick_down_3x.png}
    \includegraphics[width=5cm]{../LAB1/output/brick_down_4x.png}
    \caption{Results of downsampling the image bricks.png. From top left to bottom right: original, factor = 2, factor = 3, factor = 4}
\end{figure}


\begin{figure}[h!]
    \centering
    \includegraphics[width=5cm]{../LAB1/img/lena.png}
    \includegraphics[width=5cm]{../LAB1/output/lena_down_2x.png} \\
    \includegraphics[width=5cm]{../LAB1/output/lena_down_3x.png}
    \includegraphics[width=5cm]{../LAB1/output/lena_down_4x.png}
    \caption{Results of downsampling Lena. From top left to bottom right: original, factor = 2, factor = 3, factor = 4}
\end{figure}
